	<!DOCTYPE html>
	<meta charset="utf-8">
	<title>Modifying a force layout v4</title>

	<style>

		.link {
			stroke: #000;
			stroke-width: 1px;
			stroke-opacity: .3;
		}

		


	</style>
	<body>
		<script src="//d3js.org/d3.v4.js"></script>
		<script>

			var width = 960,
			height = 500;

			//var color = d3.scaleOrdinal(d3.schemeCategory10);

			var anchors = ["ClickMe1", "ClickMe2", "ClickMe3"];

			var nodes = [],
			links = [];



			var simulation = d3.forceSimulation()
				//.force("link", d3.forceLink().distance(200).strength(.6))
				.force("link", d3.forceLink())
				.force("charge", d3.forceManyBody())
				// use forceX and forceY instead to change the relative positioning
				.force("centering", d3.forceCenter(width/4, height/2))
				//.forceY(height-100)
				.on("tick", tick);


			var svg = d3.select("body").append("svg")
				.attr("width", width)
				.attr("height", height);

			var a = createNode("a");
			var b = createNode("b");
			var c = createNode("c");

			var data;

			d3.json("words_v4.json", function(error, graph) {
				if (error) throw error;

				data = graph;

				graph.nodes.forEach(function(d){

					d.x = width/2;
					d.y = height/2;

					if(anchors.indexOf(d.id) != -1){
				        //console.log(d.id)
				        d.fx = 100*anchors.indexOf(d.id) + 50;
				        d.fy = height;
				    }

				})

				// graph.links.forEach(function(d){
				// 	//console.log(d)
				// 	//links.push(d)
				// })
			})


		// Add nodes and links from data
		setTimeout(function() {

			for(i in data.nodes){
				var node = createNode(data.nodes[i].id);
				nodes.push(node)
			}

			for(i in data.links){
				var link = data.links[i]
				var s = findNode(link.source, nodes);
				var t = findNode(link.target, nodes);
				var d = link.value;
				var st = link.value/10

				links.push({source:s, target:t, distance: d, strength: st})
			}

			start();
		}, 100);


		function createNode(id) {
			fx = null;
			fy = null;
			if(anchors.indexOf(id) != -1){
		        console.log(id)
		        fx = 100*anchors.indexOf(id) + 100;
		        fy = height;
		      }

			return {id: id, x: width/2, y:height/2, fx: fx, fy: fy}
		}


		function findNode(id, nodes){
			for(node in nodes){
				if (nodes[node].id == id) return nodes[node];
			}
			return null;
		}



		function start() {
			
			var nodeElements = svg.selectAll(".node").data(nodes, function(d){return d.id});
			var linkElements = svg.selectAll(".link").data(links);



			// node.append('text')
		 //        .attr("text-anchor", "middle")
		 //        .style("fill", function(d){ return (anchors.indexOf(d.id) != -1)  ? "purple" : "grey";  })
		 //        .text(function(d){ return d.name;})
		 //        .attr("font-size", function(d){ return '2em'; })


		 	nodeElements.enter()
		 		.append("g")
		 		.attr("class", function(d) {return "node " + d.id; })
		 		.append("text")
		 		.attr("text-anchor", "middle")
		 		.style("fill", function(d){ return (anchors.indexOf(d.id) != -1)  ? "purple" : "grey";  })
		 		.text(function(d){ return (d.id.substring(0,7) == "midNode") ?  " " : d.id; })
		 		.attr("font-size", function(d){ return '1em'; }) //'2em'; })

				.on('mousedown', function(d){ bloom(d, data) })
		 		

			linkElements.enter().insert("line", ".node").attr("class", "link");

			nodeElements.exit().remove();
			linkElements.exit().remove();

			simulation.nodes(nodes)
			simulation.force("link").links(links)
			simulation.restart();
		}


		function tick() {

			var nodeElements = svg.selectAll(".node");
			var linkElements = svg.selectAll(".link");

			nodeElements.attr("cx", function(d,i) {return d.x; })
						.attr("cy", function(d) { return d.y; })


			nodeElements.select("text")
				.attr("transform", function(d) { 
    				return 'translate(' + [d.x, d.y] + ')';})

			linkElements.attr("x1", function(d) { return d.source.x; })
						.attr("y1", function(d) { return d.source.y; })
						.attr("x2", function(d) { return d.target.x; })
						.attr("y2", function(d) { return d.target.y; });
		}


		function bloom(d, data){
			console.log(d)

		    // // only do this if this is an anchor node
		    // if(anchors.indexOf(d.id) != -1){
		            
		    //     data.links.forEach(function(e){
		    //             // use node's "group" to set size of font for word....ToDo: rename "group"
		    //         if(d.child == e.source.id){
		    //             if(e.value > 50){ 
		    //                 e.value = 2
		    //                 e.target.group = .1;
		    //             } else {
		    //                 e.value = 100
		    //                 e.target.group = 1;
		    //             }
		    //         } 
		    //     })

		    //     //  update layout
		    //     force.linkDistance(function(d){ return d.value; })
		    //     force.start();            
		    // }
		}


	</script>