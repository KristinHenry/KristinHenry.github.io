<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Sampling</title>
    <meta name="Sampling" content="Scrollytelling Data Viz on sampling from a population" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" type="text/css" href="weepeople.css">
    <style>
      #scrolly {
        position: relative;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        background-color: #f3f3f3;
        padding: 1rem;
      }

      #scrolly > * {
        -webkit-box-flex: 1;
        -ms-flex: 1;
        flex: 1;
      }

      article {
        position: relative;
        padding: 0 1rem;
        max-width: 20rem;
      }

      figure {
        position: -webkit-sticky;
        position: sticky;
        width: 100%;
        margin: 0;
        -webkit-transform: translate3d(0, 0, 0);
        -moz-transform: translate3d(0, 0, 0);
        transform: translate3d(0, 0, 0);
        /*background-color: #8a8a8a;*/
        z-index: 0;
      }

      figure p {
        text-align: center;
        padding: 1rem;
        position: absolute;
        top: 50%;
        left: 50%;
        -moz-transform: translate(-50%, -50%);
        -webkit-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        font-size: 8rem;
        font-weight: 900;
        color: #fff;
      }

      .step {
        margin: 0 auto 2rem auto;
        /*background-color: #3b3b3b;*/
        color: #fff;
        opacity: 0;
      }

      .step:last-child {
        margin-bottom: 0;
      }

      .step.is-active {
        /*background-color: goldenrod;*/
        /*background-color: #fff;*/
        color: #3b3b3b;
        opacity: 1;
      }

      .step p {
        /*text-align: center;*/
        padding: 1rem;
        font-size: 1.2rem;
      }
    </style>
  </head>

  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container">
        <a class="navbar-brand" href="index.html">ArtAtomic: Art + Code + Science</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="index.html">Home
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://docs.google.com/forms/d/e/1FAIpQLSeNsnK06KPxxdOmU2qEYxb_TcCjexijBw_nK3UM1MHiCIECyA/viewform">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>


   <!-- Page Content -->
    <div class="container">

    <main>
      
      <section id="intro">
        <!-- <h1 class="intro__hed">How sampling reflects the whole.</h1> -->
        <!-- <p class="intro__dek">
          Start scrolling to see how it works.
        </p> -->
      </section>

      <section id="scrolly">
        <article>
          <div class="step" data-step="1">
            <p></p>
            <p>Let’s say we’re looking at a crowd of people.</p>
            <p>We want to find out something about them, but we don’t have enough time or resources to ask them all. What do we do? We choose a few people, and only ask this sample of the population.</p>
            <p>What does the way we sample a population impact what we find out?</p>
            <p>* </p>
          </div>
          <div class="step" data-step="2">
            
            <p>What if our crowd was just exposed to a virus? Let’s say it’s the covid-19 virus. Some of the people in our crowd are showing symptoms. Some are infected, but not showing any symptoms yet. </p>
            <p>This is a new disease, and we don’t yet know how to predict anything about it: how it will spread, or who is in need of most urgent care, and so on.</p>
            <p>We need to know, so that we can prepare and be ready to care for those who will become most ill.</p>
            <p>* </p>
          </div>
          <div class="step" data-step="3">
            
            <p>Let’s select people randomly. Does the sample reflect the rest of the crowd? Sometimes, but usually not</p>
            <p>* </p>
          </div>
          <div class="step" data-step="4">
            
            <p>Generate a new simulation.</p>
          </div>
        </article>

        <figure>
          <div id="chart"></div>
        </figure>
      </section>

      <section id="outro"></section>
    </main>

  </div>


  <!-- /.container -->

    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Kristin Henry 2020</p>
        <p>.</p>
      </div>
      <div class="container text-center">
        <p class="m-0 text-center text-white">Support this project with <a href="https://github.com/sponsors/KristinHenry">Github Sponsors</a></p>
        <p>.</p>
        <p class="m-0 text-center text-white">or</p>
        <p>.</p>
        <a href="https://www.patreon.com/bePatron?u=74769"><img src="imgs/become_a_patron_button.png"></a>
      </div>

      <!-- /.container -->
    </footer>

    <!-- <div class='debug'></div> -->
    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/d3@5.9.1/dist/d3.min.js"></script>
    <script src="https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js"></script>
    <script src="stickyfill.min.js"></script>
    <script src="scrollama.min.js"></script>
    <script src="d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-random.v2.min.js"></script>
    <script>


      var arr = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l",
        "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x",
        "y", "z", "A", "B", "C", "D", "E", "F", "G", "H", "I", "J",
        "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V",
        "W", "X", "Y", "Z"]

      var black =  "#2f2f30" 
      var grey = "#49494a"
      var red = "#7360db" //"#9c1e2c"

      var size = '100'

      var minAlpha = .03

      var data_people = [];
      var colors = [black, black, red] 

      //============================================================  


      // using d3 for convenience
      var main = d3.select("main");
      var scrolly = main.select("#scrolly");
      var figure = scrolly.select("figure");
      var article = scrolly.select("article");
      var step = article.selectAll(".step");
      var chartWidth = 0;

      // initialize the scrollama
      var scroller = scrollama();

      // generic window resize listener event
      function handleResize() {
        // 1. update height of step elements
        var stepH = Math.floor(window.innerHeight * 0.75);
        step.style("height", stepH + "px");

        var figureHeight = window.innerHeight / 2;
        var figureMarginTop = (window.innerHeight - figureHeight) / 2;

        chartWidth = window.innerWidth/2; //(window.innerWidth/3)*2;

        figure
          .style("height", figureHeight + "px")
          .style("top", figureMarginTop + "px")
          

        console.log('figure', figure)

        // 3. tell scrollama to update new element dimensions
        scroller.resize();
      }

      // scrollama event handlers
      function handleStepEnter(response) {
        console.log(response);
        // response = { element, direction, index }

        // add color to current step only
        step.classed("is-active", function(d, i) {
          return i === response.index;
        });

        // update graphic based on step
        // figure.select("p").text('Testing' + (response.index + 1));
        changeChart(response.index);
      }
      //=======================================================

      function changeChart(step){

        // var colors = ["purple", "blue", "teal", "green"]

        console.log('step', step)

        // d3.select("#chart").selectAll("rect")
        //   .transition().duration(1000)
        //   .style("fill", colors[step])


        var chart = d3.select("#chart").select("svg")

        var people = chart.selectAll('g').select("text")

        var info = d3.selectAll(".info")

        if(step == 0){
                        people.transition()
                        .duration(1000)
                        .attr("x", function(d){ return d.x1; })
                        .attr("y", function(d){ return d.y1; })
                        .style("fill", black)
                        .style("opacity", function(d){return d.alpha; })
                        .style("stroke-opacity", 0)
                        .style('font-size', function(d){ return d.fontsize1})

                        info.transition()
                            .duration(1000)
                            .attr("opacity", 0)
                      }

        if(step == 1){
          people.transition()
              .duration(1000)
              .attr("x", function(d){ return d.x1; })
              .attr("y", function(d){ return d.y1; })
              .style('fill', function(d){ return colors[d.health]; })
              .style("opacity", function(d){return d.alpha; })
              .style("stroke-opacity", .8)
              .style('stroke', function(d){ return d.outline })
              .style('font-size', function(d){ return d.fontsize1})

          info.transition()
                .duration(1000)
                .attr("opacity", 0)
        }


        if(step == 2){
                        people.transition()
                        .duration(1000)
                        .attr("x", function(d){ return d.x2; })
                        .attr("y", function(d){ return d.y2; })
                        .style('fill', function(d){ return colors[d.health]; })
                        .style("stroke-opacity", .4)
                        .style("opacity", .9)
                        .style("font-size", function(d){ return d.fontsize2; })


                        info.transition()
                            .duration(1000)
                            .attr("opacity", 1)
                      }


            



      }

     



      //=======================================================
      function setupStickyfill() {
        d3.selectAll(".sticky").each(function() {
          Stickyfill.add(this);
        });
      }

      function init() {
        setupStickyfill();

        // 1. force a resize on load to ensure proper dimensions are sent to scrollama
        handleResize();

        // 2. setup the scroller passing options
        //    this will also initialize trigger observations
        // 3. bind scrollama event handlers (this can be chained like below)
        scroller
          .setup({
            step: "#scrolly article .step",
            offset: 0.33,
            debug: true
          })
          .onStepEnter(handleStepEnter);

        // setup resize event
        window.addEventListener("resize", handleResize);


        // initialize chart
        // figure.select("p").text('Testing initialization');
        var chart = d3.select("#chart").append("svg")
                      .attr("width", chartWidth)  
                      .attr("height", 260)


        makePeople()
        
      }


      function setHealth(){

        // health is about clear (0) vs carriers (1), vs sick (2)

        // set default health for all people
        for(i in data_people){
            data_people[i]["health"] = 0;
            console.log('i', i)
        }

        // pick 10 random people to assign as 'carrier'
        for(var i in [0,1,2,3,4,5,6,7,8,9]){
          console.log('testing', i)
          data_people[d3.randomInt(data_people.length)()]["health"] = 1;

          console.log('health for ', i)
        }

        // pick 5 random people to assign as 'sick'
        for(var i in [0,1,2,3,4]){
          data_people[d3.randomInt(data_people.length)()]["health"] = 2;
        }

        // this is where I'd select random people to be 'recovered'
        //
        //

        // set health indicator as color for all people
        for(i in data_people){
            var cell = data_people[i]
            cell["color"] = colors[cell.health];
            cell["outline"] = cell.health == 1 ? red : black;
        }
      }


      function takeSample(){

        var height = 260;

        console.log('take sample')

        // Set default 'not-sample' status-->most of the cells will drop and shrink
        for(var i in data_people){
          var cell = data_people[i];
              cell["sample"] = false;
              cell["x2"] = cell.x1;
              cell["y2"] = height;
              cell["fontsize2"] = '20px';
        }

        
        // randomly select 10 people for sample
        for(var i in [0,1,2,3,4,5,6,7,8,9]){
          var cell = data_people[d3.randomInt(data_people.length)()];
              cell["sample"] = true;
              cell["x2"] = cell.x1; //d3.randomInt(400, 500);
              cell["y2"] = cell.y1;
              cell["fontsize2"] = '120px';

        }

      }



      function makePeople(){

        // ToDo: change these to figure values
        var width = chartWidth;
        var height = 260;

        console.log('Make people-----------------')
        // console.log(arr)
        // var figure = scrolly.select("figure");
        // console.log('fig', figure)


        for(p in arr){

          // console.log(' p', p)

          // starting positions for people
          var x1 = d3.randomInt(20, width-80)();
          var y1 = height-20 - 2*p;


          var cell = {"txt": arr[p]}
            cell["x1"] = x1;
            cell["y1"] = y1;
            cell["alpha"] = 1-(p*.02);        
            cell["fontsize1"] = '120px'

            data_people.push(cell)
          }


          setHealth();
          takeSample();

          

          // sort into samples vs population and their health groups
          // this is so we can arrange them in the chart
          var sample_0 = [];
          var sample_1 = [];
          var sample_2 = [];
          var pop_0 = [];
          var pop_1 = [];
          var pop_2 = [];
          for(cell in data_people){
            var p = data_people[cell]
            if(p.sample){
              if(p.health == 0) sample_0.push(p)
              if(p.health == 1) sample_1.push(p)
              if(p.health == 2) sample_2.push(p)
            } else {
              if(p.health == 0) pop_0.push(p)
              if(p.health == 1) pop_1.push(p)
              if(p.health == 2) pop_2.push(p)
            }
          }

          var sample_infection = sample_1.length;
          var sample_sick = sample_2.length;
          var pop_infection = sample_1.length + pop_1.length;
          var pop_sick = sample_2.length + pop_2.length;

          console.log('rate', sample_infection)

          var samples = sample_0.concat(sample_1.concat(sample_2))
          var pops = pop_0.concat(pop_1.concat(pop_2))
          




          // calculate position based on sorted by health index
          for(s in samples){
            // console.log(s)
            samples[s].x2 = s*50;
            samples[s].y2 = 100;
          }

          for(p in pops){
            pops[p].x2 = p*10;
          }

          

        var chart = d3.select("#chart").select("svg")

        var people = chart.selectAll('g')
                        .data(data_people)
                        .enter()
                        .append('g')              

        people.append('text')
              .text(function(d){ return d.txt; })
              .style('font-size', '120px')
              .style('fill', black)
              // .style('fill', function(d){ return colors[d.health]; })
              // .style('stroke', function(d){ return d.outline })
              .style('stroke-width', function(d){ return  d.health == 1 ? "2px" : "0px";  })
              .style('opacity', function(d){ return d.alpha; })
              .attr('x', function(d){ return d.x1 })
              .attr('y', function(d){ return d.y1; })
              .attr('class', 'weepeople')


        var info_1 = chart.append('text')
                          .text("Infections: " + sample_infection + "%  Illness: " + sample_sick + "%")
                          .attr('text-anchor', 'middle')
                          .attr('x', Math.floor(width/2))
                          .attr('y', 130)
                          .attr('width', width)
                          .attr('opacity', 0)
                          .attr('class', 'info')

        var info_2 = chart.append('text')
                          .text("Infections: " + pop_infection + "%  Illness: " + pop_sick + "%")
                          .attr('text-anchor', 'middle')
                          .attr('x', Math.floor(width/2))
                          .attr('y', 220)
                          .attr('width', width)
                          .attr('opacity', 0)
                          .attr('class', 'info')


      }




      // kick things off
      init();
    </script>
  </body>
</html>
